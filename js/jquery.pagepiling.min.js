/* ===========================================================
 * pagepiling.js 1.0
 *
 * https://github.com/alvarotrigo/pagePiling.js
 * MIT licensed
 *
 * Copyright (C) 2014 alvarotrigo.com - A project by Alvaro Trigo
 *
 * ========================================================== */
 
!function(n){n.fn.pagepiling=function(e){function t(e){var t=n(".pp-section.active").index(".pp-section");return e=e.index(".pp-section"),t>e?"up":"down"}function o(o,a){var s={destination:o,animated:a,activeSection:n(".pp-section.active"),anchorLink:o.data("anchor"),sectionIndex:o.index(".pp-section"),toMove:o,yMovement:t(o),leavingSection:n(".pp-section.active").index(".pp-section")+1};s.activeSection.is(o)||("undefined"==typeof s.animated&&(s.animated=!0),"undefined"!=typeof s.anchorLink&&l(s.anchorLink,s.sectionIndex),s.destination.addClass("active").siblings().removeClass("active"),s.sectionsToMove=c(s),"down"===s.yMovement?(s.translate3d="vertical"!==e.direction?"translate3d(-100%, 0px, 0px)":"translate3d(0px, -100%, 0px)",s.scrolling="-100%",e.css3||s.sectionsToMove.each(function(e){e!=s.activeSection.index(".pp-section")&&n(this).css(r(s.scrolling))}),s.animateSection=s.activeSection):(s.translate3d="translate3d(0px, 0px, 0px)",s.scrolling="0",s.animateSection=o),n.isFunction(e.onLeave)&&e.onLeave.call(this,s.leavingSection,s.sectionIndex+1,s.yMovement),i(s),M(s.anchorLink),b(s.anchorLink,s.sectionIndex),C=s.anchorLink,k=(new Date).getTime())}function i(t){e.css3?(u(t.animateSection,t.translate3d,t.animated),t.sectionsToMove.each(function(){u(n(this),t.translate3d,t.animated)}),setTimeout(function(){a(t)},e.scrollingSpeed)):(t.scrollOptions=r(t.scrolling),t.animated?t.animateSection.animate(t.scrollOptions,e.scrollingSpeed,e.easing,function(){s(t),a(t)}):(t.animateSection.css(r(t.scrolling)),setTimeout(function(){s(t),a(t)},400)))}function a(t){n.isFunction(e.afterLoad)&&e.afterLoad.call(this,t.anchorLink,t.sectionIndex+1)}function c(e){return n(".pp-section").map("down"===e.yMovement?function(t){return t<e.destination.index(".pp-section")?n(this):void 0}:function(t){return t>e.destination.index(".pp-section")?n(this):void 0})}function s(e){"up"===e.yMovement&&e.sectionsToMove.each(function(){n(this).css(r(e.scrolling))})}function r(n){return"vertical"===e.direction?{top:n}:{left:n}}function l(n,t){e.anchors.length?(location.hash=n,p(location.hash)):p(String(t))}function p(e){e=e.replace("#",""),n("body")[0].className=n("body")[0].className.replace(/\b\s?pp-viewing-[^\s]+\b/g,""),n("body").addClass("pp-viewing-"+e)}function d(){return(new Date).getTime()-k<600+e.scrollingSpeed?!0:!1}function u(n,e,t){n.toggleClass("pp-easing",t),n.css({"-webkit-transform":e,"-moz-transform":e,"-ms-transform":e,transform:e})}function h(e){if(!d()){e=window.event||e,e=Math.max(-1,Math.min(1,e.wheelDelta||-e.deltaY||-e.detail));var t=n(".pp-section.active"),t=v(t);return 0>e?f("down",t):f("up",t),!1}}function f(e,t){if("down"==e)var o="bottom",i=n.fn.pagepiling.moveSectionDown;else o="top",i=n.fn.pagepiling.moveSectionUp;if(0<t.length){if(!isScrolled(o,t))return!0;i()}else i()}function v(n){return scrollable=n.find(".pp-scrollable")}function g(){return window.PointerEvent?{down:"pointerdown",move:"pointermove",up:"pointerup"}:{down:"MSPointerDown",move:"MSPointerMove",up:"MSPointerUp"}}function m(n){var e=[];return e.y="undefined"!=typeof n.pageY&&(n.pageY||n.pageX)?n.pageY:n.touches[0].pageY,e.x="undefined"!=typeof n.pageX&&(n.pageY||n.pageX)?n.pageX:n.touches[0].pageX,e}function S(n){n=m(n.originalEvent),X=n.y,touchStartX=n.x}function w(t){var o=t.originalEvent;x(t.target)||(t.preventDefault(),t=n(".pp-section.active"),t=v(t),d()||(o=m(o),touchEndY=o.y,touchEndX=o.x,"horizontal"===e.direction&&Math.abs(touchStartX-touchEndX)>Math.abs(X-touchEndY)?Math.abs(touchStartX-touchEndX)>T.width()/100*e.touchSensitivity&&(touchStartX>touchEndX?f("down",t):touchEndX>touchStartX&&f("up",t)):Math.abs(X-touchEndY)>T.height()/100*e.touchSensitivity&&(X>touchEndY?f("down",t):touchEndY>X&&f("up",t))))}function x(t,o){o=o||0;var i=n(t).parent();return o<e.normalScrollElementTouchThreshold&&i.is(e.normalScrollElements)?!0:o==e.normalScrollElementTouchThreshold?!1:x(i,++o)}function y(){n("body").append('<div id="pp-nav"><ul></ul></div>');var t=n("#pp-nav");t.css("color",e.navigation.textColor),t.addClass(e.navigation.position);for(var o=0;o<n(".pp-section").length;o++){var i="";if(e.anchors.length&&(i=e.anchors[o]),"undefined"!=typeof e.navigation.tooltips){var a=e.navigation.tooltips[o];"undefined"==typeof a&&(a="")}t.find("ul").append('<li data-tooltip="'+a+'"><a href="#'+i+'"><span></span></a></li>')}t.find("span").css("border-color",e.navigation.bulletsColor)}function b(t,o){e.navigation&&(n("#pp-nav").find(".active").removeClass("active"),t?n("#pp-nav").find('a[href="#'+t+'"]').addClass("active"):n("#pp-nav").find("li").eq(o).find("a").addClass("active"))}function M(t){e.menu&&(n(e.menu).find(".active").removeClass("active"),n(e.menu).find('[data-menuanchor="'+t+'"]').addClass("active"))}function E(){var n,e=document.createElement("p"),t={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var o in t)void 0!==e.style[o]&&(e.style[o]="translate3d(1px,1px,1px)",n=window.getComputedStyle(e).getPropertyValue(t[o]));return document.body.removeChild(e),void 0!==n&&0<n.length&&"none"!==n}var C,T=n(this),k=0,L="ontouchstart"in window||0<navigator.msMaxTouchPoints||navigator.maxTouchPoints,X=touchStartX=touchEndY=touchEndX=0;e=n.extend({direction:"vertical",menu:null,verticalCentered:!0,sectionsColor:[],anchors:[],scrollingSpeed:700,easing:"easeInQuart",loopBottom:!1,loopTop:!1,css3:!0,navigation:{textColor:"#000",bulletsColor:"#000",position:"right",tooltips:["section1","section2","section3","section4"]},normalScrollElements:null,normalScrollElementTouchThreshold:5,touchSensitivity:5,keyboardScrolling:!0,sectionSelector:".section",animateAnchor:!1,afterLoad:null,onLeave:null,afterRender:null},e),n.extend(n.easing,{easeInQuart:function(n,e,t,o,i){return o*(e/=i)*e*e*e+t}}),n.fn.pagepiling.setScrollingSpeed=function(n){e.scrollingSpeed=n},n.fn.pagepiling.setMouseWheelScrolling=function(n){n?T.get(0).addEventListener?(T.get(0).addEventListener("mousewheel",h,!1),T.get(0).addEventListener("wheel",h,!1)):T.get(0).attachEvent("onmousewheel",h):T.get(0).addEventListener?(T.get(0).removeEventListener("mousewheel",h,!1),T.get(0).removeEventListener("wheel",h,!1)):T.get(0).detachEvent("onmousewheel",h)},n.fn.pagepiling.setAllowScrolling=function(e){e?(n.fn.pagepiling.setMouseWheelScrolling(!0),L&&(MSPointer=g(),T.off("touchstart "+MSPointer.down).on("touchstart "+MSPointer.down,S),T.off("touchmove "+MSPointer.move).on("touchmove "+MSPointer.move,w))):(n.fn.pagepiling.setMouseWheelScrolling(!1),L&&(MSPointer=g(),T.off("touchstart "+MSPointer.down),T.off("touchmove "+MSPointer.move)))},n.fn.pagepiling.setKeyboardScrolling=function(n){e.keyboardScrolling=n},n.fn.pagepiling.moveSectionUp=function(){var t=n(".pp-section.active").prev(".pp-section");!t.length&&e.loopTop&&(t=n(".pp-section").last()),t.length&&o(t)},n.fn.pagepiling.moveSectionDown=function(){var t=n(".pp-section.active").next(".pp-section");!t.length&&e.loopBottom&&(t=n(".pp-section").first()),t.length&&o(t)},n.fn.pagepiling.moveTo=function(e){var t="",t=isNaN(e)?n('[data-anchor="'+e+'"]'):n(".pp-section").eq(e-1);0<t.length&&o(t)},n(e.sectionSelector).each(function(){n(this).addClass("pp-section")}),e.css3&&(e.css3=E()),n(T).css({overflow:"hidden","-ms-touch-action":"none","touch-action":"none"}),n.fn.pagepiling.setAllowScrolling(!0),n.isEmptyObject(e.navigation)||y();var P=n(".pp-section").length;n(".pp-section").each(function(t){n(this).data("data-index",t),n(this).css("z-index",P),t||0!==n(".pp-section.active").length||n(this).addClass("active"),"undefined"!=typeof e.anchors[t]&&n(this).attr("data-anchor",e.anchors[t]),"undefined"!=typeof e.sectionsColor[t]&&n(this).css("background-color",e.sectionsColor[t]),e.verticalCentered&&n(this).addClass("pp-table").wrapInner('<div class="pp-tableCell" style="height:100%" />'),--P}).promise().done(function(){e.navigation&&(n("#pp-nav").css("margin-top","-"+n("#pp-nav").height()/2+"px"),n("#pp-nav").find("li").eq(n(".pp-section.active").index(".pp-section")).find("a").addClass("active")),n(window).on("load",function(){var t=window.location.hash.replace("#",""),t=n('.pp-section[data-anchor="'+t+'"]');0<t.length&&o(t,e.animateAnchor)}),n.isFunction(e.afterRender)&&e.afterRender.call(this)}),n(window).on("hashchange",function(){var e=window.location.hash.replace("#","").split("/")[0];e.length&&e&&e!==C&&(e=isNaN(e)?n('[data-anchor="'+e+'"]'):n(".pp-section").eq(e-1),o(e))}),n(document).keydown(function(t){if(e.keyboardScrolling&&!d())switch(t.which){case 38:case 33:n.fn.pagepiling.moveSectionUp();break;case 40:case 34:n.fn.pagepiling.moveSectionDown();break;case 36:n.fn.pagepiling.moveTo(1);break;case 35:n.fn.pagepiling.moveTo(n(".pp-section").length);break;case 37:n.fn.pagepiling.moveSectionUp();break;case 39:n.fn.pagepiling.moveSectionDown()}}),e.normalScrollElements&&(n(document).on("mouseenter",e.normalScrollElements,function(){n.fn.pagepiling.setMouseWheelScrolling(!1)}),n(document).on("mouseleave",e.normalScrollElements,function(){n.fn.pagepiling.setMouseWheelScrolling(!0)})),n(document).on("click touchstart","#pp-nav a",function(e){e.preventDefault(),e=n(this).parent().index(),o(n(".pp-section").eq(e))}),n(document).on({mouseenter:function(){var t=n(this).data("tooltip");n('<div class="pp-tooltip '+e.navigation.position+'">'+t+"</div>").hide().appendTo(n(this)).fadeIn(200)},mouseleave:function(){n(this).find(".pp-tooltip").fadeOut(200,function(){n(this).remove()})}},"#pp-nav li")}}(jQuery);